{% extends 'base_vehicle.html' %} {% block pagecontent %}

<h2>Expense Manager</h2>

{% if not userexpenses %}
<br>
<div>
  <p>You don't have any expenses recorded yet.</p>
  <p>Record one <a href="/vehicle/{{ car.key.id }}/expenses/add">here</a>!</p>
</div>
{% else %}
<h3>Total Money Spent: ${{ expensetotal|stringformat:".2f" }}</h3>
<div>
  <div class="btn-group" class="pull-right" data-toggle="buttons-radio">
    <button type="button" class="btn">Most Recent Purchase</button>
    <button type="button" class="btn">1 M</button>
    <button type="button" class="btn">3 M</button>
    <button type="button" class="btn">1 Yr</button>
    <button type="button" class="btn">All</button>
    <button type="button" class="btn">Custom</button>
  </div>
  <div class="pull-right">
    <a class="btn btn-primary pull-right" href="/vehicle/{{ car.key.id }}/expenses/add">Add Expense</a>
  </div>
</div>

<table class="table table-striped table-bordered" id="expense-table">
  <thead>
    <tr>
      <th>Date</th>
      <th>Category</th>
      <th>Location</th>
      <th>Description</th>
      <th>Cost</th>
      <th>Picture</th>
    </tr>
  </thead>
  {% for e in userexpenses %}
  <tr>
    <td>{{ e.date|date:"Y-m-d" }}</td>
    <td>{{ e.category }}</td>
    <td>{{ e.location }}</td>
    <td>{{ e.description }}</td>
    <td>{{ e.amount|stringformat:".2f" }}</td>
    
    {% if e.picture %}
    <td><button type="button" class="btn btn-success receiptlink" value="/blob/{{ e.picture }}">Receipt</a></td>
    {% else %}
    <td>N/A</td>
    {% endif %}
  </tr>
  {% endfor %}
</table>

<div id="displayimage" class="modal hide fade">
  <img id="modalimage">
</div>

{% endif %} {% endblock %} {% block externaljs %}

<script type="text/javascript" src="/static/js/ext/jquery.dataTables.min.js"></script>
<script>
	$(document).ready(function() {
		var dTable = $('#expense-table').dataTable({
			"sDom" : "<'row'<'span6'l><'span6'f>r>t",
			"bPaginate" : false,
			"bLengthChange" : false,
			"bFilter" : false,
			"bSort" : true,
			"bInfo" : false,
			"bAutoWidth" : false,
			"aaSorting" : [ [ 0, 'desc' ] ]
		});
	});
	
	//TODO move to own js file
	$('.receiptlink').click( function() {
		$('#displayimage').modal();
		$('#modalimage').attr('src', this.getAttribute('value'));
	});
	
	//TODO
	// 	make modal to upload images in editable table mode
	//	make editable table mode and display the columns that need to be able to be edited
	//	move this js to separate file
	
</script>

{% endblock %}
